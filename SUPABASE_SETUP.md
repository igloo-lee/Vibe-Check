# Supabase Setup Guide

이 프로젝트는 대화 내용을 저장하기 위해 **Supabase**를 데이터베이스로 사용합니다.
다음 단계를 따라 Supabase 프로젝트를 설정해 주세요.

## 1. Supabase 프로젝트 생성
1. [Supabase](https://supabase.com/)에 접속하여 로그인하고 새 프로젝트를 생성하세요.
2. 프로젝트가 생성되면 왼쪽 사이드바의 **Project Settings > API**로 이동하여 다음 정보를 확인하세요.
   - Project URL
   - anon public key

## 2. 환경 변수 설정
프로젝트 루트의 `.env.local` 파일을 열고(없으면 생성) 다음 내용을 추가하세요.
기존 `GEMINI_API_KEY`도 `VITE_GEMINI_API_KEY` 형식으로 변경하는 것을 권장합니다 (코드에서 `import.meta.env.VITE_GEMINI_API_KEY`를 사용하도록 수정되었습니다).

```env
# Gemini API Key (기존 키가 있다면 이름을 변경하거나 새로 추가하세요)
VITE_GEMINI_API_KEY=your_gemini_api_key_here

# Supabase Configuration
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## 3. 데이터베이스 테이블 생성
Supabase 대시보드의 **SQL Editor**로 이동하여 다음 SQL 쿼리를 실행하세요.

```sql
-- 세션 정보를 저장할 테이블
create table sessions (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  my_nickname text not null,
  partner_name text not null,
  relationship text,
  worry_content text
);

-- 대화 내용을 저장할 테이블
create table messages (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  session_id uuid references sessions(id) on delete cascade not null,
  content text not null,
  is_user boolean not null
);

-- Row Level Security (RLS) 설정 (선택 사항: 익명 사용자 허용을 위해 필요)
-- 개발 편의를 위해 익명 쓰기 허용 (실제 서비스 시에는 인증 정책을 강화해야 합니다)
alter table sessions enable row level security;
alter table messages enable row level security;

create policy "Enable insert for everyone" on sessions for insert with check (true);
create policy "Enable select for everyone" on sessions for select using (true);
create policy "Enable insert for everyone" on messages for insert with check (true);
create policy "Enable select for everyone" on messages for select using (true);
```

이제 앱을 실행(`npm run dev`)하면 채팅 내역이 Supabase에 자동으로 저장됩니다.
